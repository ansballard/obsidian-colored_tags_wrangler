var _a;
import { __awaiter } from "tslib";
// ---------------------------------------------------------------------------------------------------------------------
// Imports
// ---------------------------------------------------------------------------------------------------------------------
import * as migrations from "./migrations";
import { Notice } from "obsidian";
// ---------------------------------------------------------------------------------------------------------------------
// Support Code
// ---------------------------------------------------------------------------------------------------------------------
export class MigratorService {
    // -----------------------------------------------------------------------------------------------------------------
    // Constructors
    // -----------------------------------------------------------------------------------------------------------------
    constructor(plugin) {
        this.plugin = plugin;
    }
    // -----------------------------------------------------------------------------------------------------------------
    // Methods
    // -----------------------------------------------------------------------------------------------------------------
    migrateData(data) {
        var _b, _c;
        return __awaiter(this, void 0, void 0, function* () {
            // If the plugin hasn't been used before, no data will be present aka no migrations needed
            if (data === null) {
                return null;
            }
            // Set a default version, else the migrations won't work.
            let version = (_c = (_b = data === null || data === void 0 ? void 0 : data.Info) === null || _b === void 0 ? void 0 : _b.SettingsVersion) !== null && _c !== void 0 ? _c : -1;
            if (version === -1 || version <= 14) {
                // copy the data file to the backup location
                yield this.plugin.app.vault.adapter.copy(`${this.plugin.manifest.dir}/data.json`, `${this.plugin.manifest.dir}/data_backup.json`);
            }
            if (version === -1) {
                // Exit clause
                console.warn("Version could not be established, assigning as is. Created a data_backup.json file.");
                new Notice("ColoredTagsWrangler : <br>Version could not be read from data.json. Backup created as data_backup.json file.");
                return data;
            }
            if (version <= 14) {
                new Notice("ColoredTagsWrangler : <br>data.json was made for a lower version, upgrading it to the newest version. Backup created as data_backup.json file.");
            }
            // Actual migrations
            let migratedData = data;
            for (version; version < MigratorService.MIGRATION_STEPS.length; version++) {
                migratedData = yield MigratorService.MIGRATION_STEPS[version](migratedData);
                console.log(`Migrated data.json from ColoredTagsWrangler to version ${migratedData.Info.SettingsVersion}`);
            }
            return migratedData;
        });
    }
}
_a = MigratorService;
MigratorService.MIGRATION_STEPS = [
    // Add more lambdas in order.
    //      Btw this only works because I am dumb enough to start from 0,
    //      that way I don't need to do any other steps in the for loop
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_00_to_01(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_01_to_02(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_02_to_03(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_03_to_04(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_04_to_05(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_05_to_06(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_06_to_07(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_07_to_08(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_08_to_09(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_09_to_10(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_10_to_11(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_11_to_12(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_12_to_13(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_13_to_14(data); }),
    (data) => __awaiter(void 0, void 0, void 0, function* () { return yield migrations.migrate_14_to_15(data); }), // 14
];
// I have become too lazy to keep track of which version we are on.
MigratorService.CURRENT_VERSION = MigratorService.MIGRATION_STEPS.length + 1;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWlncmF0b3JTZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTWlncmF0b3JTZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0hBQXdIO0FBQ3hILFVBQVU7QUFDVix3SEFBd0g7QUFDeEgsT0FBTyxLQUFLLFVBQVUsTUFBTSxjQUFjLENBQUM7QUFFM0MsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUdoQyx3SEFBd0g7QUFDeEgsZUFBZTtBQUNmLHdIQUF3SDtBQUN4SCxNQUFNLE9BQU8sZUFBZTtJQTJCM0Isb0hBQW9IO0lBQ3BILGVBQWU7SUFDZixvSEFBb0g7SUFDcEgsWUFBWSxNQUFpQztRQUM1QyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN0QixDQUFDO0lBRUQsb0hBQW9IO0lBQ3BILFVBQVU7SUFDVixvSEFBb0g7SUFDdkcsV0FBVyxDQUFDLElBQVM7OztZQUNqQywwRkFBMEY7WUFDMUYsSUFBSSxJQUFJLEtBQUssSUFBSSxFQUFDO2dCQUNqQixPQUFPLElBQUksQ0FBQTthQUNYO1lBRUQseURBQXlEO1lBQ3pELElBQUksT0FBTyxHQUFHLE1BQUEsTUFBQSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsSUFBSSwwQ0FBRSxlQUFlLG1DQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2hELElBQUksT0FBTyxLQUFLLENBQUMsQ0FBQyxJQUFJLE9BQU8sSUFBSSxFQUFFLEVBQUM7Z0JBQ25DLDRDQUE0QztnQkFDNUMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FDdkMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLFlBQVksRUFDdkMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLG1CQUFtQixDQUM5QyxDQUFDO2FBQ0Y7WUFFRCxJQUFJLE9BQU8sS0FBSyxDQUFDLENBQUMsRUFBQztnQkFDbEIsY0FBYztnQkFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLHFGQUFxRixDQUFDLENBQUE7Z0JBQ25HLElBQUksTUFBTSxDQUFDLDhHQUE4RyxDQUFDLENBQUM7Z0JBQzNILE9BQU8sSUFBSSxDQUFDO2FBQ1o7WUFFRCxJQUFJLE9BQU8sSUFBSSxFQUFFLEVBQUM7Z0JBQ2pCLElBQUksTUFBTSxDQUFDLGdKQUFnSixDQUFDLENBQUE7YUFDNUo7WUFFRCxvQkFBb0I7WUFDcEIsSUFBSSxZQUFZLEdBQW9CLElBQUksQ0FBQztZQUN6QyxLQUFLLE9BQU8sRUFBRSxPQUFPLEdBQUcsZUFBZSxDQUFDLGVBQWUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUU7Z0JBQzFFLFlBQVksR0FBRyxNQUFNLGVBQWUsQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQzVFLE9BQU8sQ0FBQyxHQUFHLENBQUMsMERBQTBELFlBQVksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQTthQUMxRztZQUVELE9BQU8sWUFBWSxDQUFDOztLQUNwQjs7O0FBckVjLCtCQUFlLEdBQXFDO0lBQ2xFLDZCQUE2QjtJQUM3QixxRUFBcUU7SUFDckUsbUVBQW1FO0lBQ25FLENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBO0lBQ3ZELENBQU8sSUFBSSxFQUFFLEVBQUUsa0RBQUMsT0FBQSxNQUFNLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQSxHQUFBLEVBQUUsS0FBSztDQUM3RCxDQUFBO0FBRUYsbUVBQW1FO0FBQ3JELCtCQUFlLEdBQUcsZUFBZSxDQUFDLGVBQWUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vIEltcG9ydHNcclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbmltcG9ydCAqIGFzIG1pZ3JhdGlvbnMgZnJvbSBcIi4vbWlncmF0aW9uc1wiO1xyXG5pbXBvcnQge0lQbHVnaW5TZXR0aW5nc30gZnJvbSBcIi4uLy4uLy4uL2NvbnRyYWN0cy9wbHVnaW4vc2V0dGluZ3MvSVBsdWdpblNldHRpbmdzXCI7XHJcbmltcG9ydCB7Tm90aWNlfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IHtJQ29sb3JlZFRhZ1dyYW5nbGVyUGx1Z2lufSBmcm9tIFwiLi4vLi4vLi4vY29udHJhY3RzL3BsdWdpbi9JQ29sb3JlZFRhZ1dyYW5nbGVyUGx1Z2luXCI7XHJcbmltcG9ydCB7SU1pZ3JhdG9yU2VydmljZX0gZnJvbSBcIi4uLy4uLy4uL2NvbnRyYWN0cy9wbHVnaW4vc2VydmljZXMvbWlncmF0b3IvSU1pZ3JhdG9yU2VydmljZVwiO1xyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8gU3VwcG9ydCBDb2RlXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5leHBvcnQgY2xhc3MgTWlncmF0b3JTZXJ2aWNlIGltcGxlbWVudHMgSU1pZ3JhdG9yU2VydmljZXtcclxuXHRwcml2YXRlIHBsdWdpbjogSUNvbG9yZWRUYWdXcmFuZ2xlclBsdWdpbjtcclxuXHJcblx0cHJpdmF0ZSBzdGF0aWMgTUlHUkFUSU9OX1NURVBTOiAoKGRhdGEgOiBhbnkpID0+IFByb21pc2U8YW55PilbXSA9IFsgLy8gVXNpbmcgYW55J3MgaXNuJ3QgcGVyZmVjdCBidXQgd2lsbCBkbyBmb3Igbm93XHJcblx0XHQvLyBBZGQgbW9yZSBsYW1iZGFzIGluIG9yZGVyLlxyXG5cdFx0Ly8gICAgICBCdHcgdGhpcyBvbmx5IHdvcmtzIGJlY2F1c2UgSSBhbSBkdW1iIGVub3VnaCB0byBzdGFydCBmcm9tIDAsXHJcblx0XHQvLyAgICAgIHRoYXQgd2F5IEkgZG9uJ3QgbmVlZCB0byBkbyBhbnkgb3RoZXIgc3RlcHMgaW4gdGhlIGZvciBsb29wXHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzAwX3RvXzAxKGRhdGEpLCAvLyAwXHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzAxX3RvXzAyKGRhdGEpLCAvLyAxXHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzAyX3RvXzAzKGRhdGEpLCAvLyAyXHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzAzX3RvXzA0KGRhdGEpLCAvLyAzXHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzA0X3RvXzA1KGRhdGEpLCAvLyA0XHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzA1X3RvXzA2KGRhdGEpLCAvLyA1XHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzA2X3RvXzA3KGRhdGEpLCAvLyA2XHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzA3X3RvXzA4KGRhdGEpLCAvLyA3XHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzA4X3RvXzA5KGRhdGEpLCAvLyA4XHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzA5X3RvXzEwKGRhdGEpLCAvLyA5XHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzEwX3RvXzExKGRhdGEpLCAvLyAxMFxyXG5cdFx0YXN5bmMgKGRhdGEpID0+IGF3YWl0IG1pZ3JhdGlvbnMubWlncmF0ZV8xMV90b18xMihkYXRhKSwgLy8gMTFcclxuXHRcdGFzeW5jIChkYXRhKSA9PiBhd2FpdCBtaWdyYXRpb25zLm1pZ3JhdGVfMTJfdG9fMTMoZGF0YSksIC8vIDEyXHJcblx0XHRhc3luYyAoZGF0YSkgPT4gYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlXzEzX3RvXzE0KGRhdGEpLCAvLyAxM1xyXG5cdFx0YXN5bmMgKGRhdGEpID0+IGF3YWl0IG1pZ3JhdGlvbnMubWlncmF0ZV8xNF90b18xNShkYXRhKSwgLy8gMTRcclxuXHRdO1xyXG5cclxuXHQvLyBJIGhhdmUgYmVjb21lIHRvbyBsYXp5IHRvIGtlZXAgdHJhY2sgb2Ygd2hpY2ggdmVyc2lvbiB3ZSBhcmUgb24uXHJcblx0cHVibGljIHN0YXRpYyBDVVJSRU5UX1ZFUlNJT04gPSBNaWdyYXRvclNlcnZpY2UuTUlHUkFUSU9OX1NURVBTLmxlbmd0aCArIDFcclxuXHJcblx0Ly8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHQvLyBDb25zdHJ1Y3RvcnNcclxuXHQvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cdGNvbnN0cnVjdG9yKHBsdWdpbjogSUNvbG9yZWRUYWdXcmFuZ2xlclBsdWdpbikge1xyXG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcblx0fVxyXG5cclxuXHQvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cdC8vIE1ldGhvZHNcclxuXHQvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cdHB1YmxpYyBhc3luYyBtaWdyYXRlRGF0YShkYXRhOiBhbnksICk6IFByb21pc2U8YW55PiB7XHJcblx0XHQvLyBJZiB0aGUgcGx1Z2luIGhhc24ndCBiZWVuIHVzZWQgYmVmb3JlLCBubyBkYXRhIHdpbGwgYmUgcHJlc2VudCBha2Egbm8gbWlncmF0aW9ucyBuZWVkZWRcclxuXHRcdGlmIChkYXRhID09PSBudWxsKXtcclxuXHRcdFx0cmV0dXJuIG51bGxcclxuXHRcdH1cclxuXHJcblx0XHQvLyBTZXQgYSBkZWZhdWx0IHZlcnNpb24sIGVsc2UgdGhlIG1pZ3JhdGlvbnMgd29uJ3Qgd29yay5cclxuXHRcdGxldCB2ZXJzaW9uID0gZGF0YT8uSW5mbz8uU2V0dGluZ3NWZXJzaW9uID8/IC0xO1xyXG5cdFx0aWYgKHZlcnNpb24gPT09IC0xIHx8IHZlcnNpb24gPD0gMTQpe1xyXG5cdFx0XHQvLyBjb3B5IHRoZSBkYXRhIGZpbGUgdG8gdGhlIGJhY2t1cCBsb2NhdGlvblxyXG5cdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5hcHAudmF1bHQuYWRhcHRlci5jb3B5KFxyXG5cdFx0XHRcdGAke3RoaXMucGx1Z2luLm1hbmlmZXN0LmRpcn0vZGF0YS5qc29uYCxcclxuXHRcdFx0XHRgJHt0aGlzLnBsdWdpbi5tYW5pZmVzdC5kaXJ9L2RhdGFfYmFja3VwLmpzb25gXHJcblx0XHRcdCk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHZlcnNpb24gPT09IC0xKXtcclxuXHRcdFx0Ly8gRXhpdCBjbGF1c2VcclxuXHRcdFx0Y29uc29sZS53YXJuKFwiVmVyc2lvbiBjb3VsZCBub3QgYmUgZXN0YWJsaXNoZWQsIGFzc2lnbmluZyBhcyBpcy4gQ3JlYXRlZCBhIGRhdGFfYmFja3VwLmpzb24gZmlsZS5cIilcclxuXHRcdFx0bmV3IE5vdGljZShcIkNvbG9yZWRUYWdzV3JhbmdsZXIgOiA8YnI+VmVyc2lvbiBjb3VsZCBub3QgYmUgcmVhZCBmcm9tIGRhdGEuanNvbi4gQmFja3VwIGNyZWF0ZWQgYXMgZGF0YV9iYWNrdXAuanNvbiBmaWxlLlwiKTtcclxuXHRcdFx0cmV0dXJuIGRhdGE7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHZlcnNpb24gPD0gMTQpe1xyXG5cdFx0XHRuZXcgTm90aWNlKFwiQ29sb3JlZFRhZ3NXcmFuZ2xlciA6IDxicj5kYXRhLmpzb24gd2FzIG1hZGUgZm9yIGEgbG93ZXIgdmVyc2lvbiwgdXBncmFkaW5nIGl0IHRvIHRoZSBuZXdlc3QgdmVyc2lvbi4gQmFja3VwIGNyZWF0ZWQgYXMgZGF0YV9iYWNrdXAuanNvbiBmaWxlLlwiKVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIEFjdHVhbCBtaWdyYXRpb25zXHJcblx0XHRsZXQgbWlncmF0ZWREYXRhOiBJUGx1Z2luU2V0dGluZ3MgPSBkYXRhO1xyXG5cdFx0Zm9yICh2ZXJzaW9uOyB2ZXJzaW9uIDwgTWlncmF0b3JTZXJ2aWNlLk1JR1JBVElPTl9TVEVQUy5sZW5ndGg7IHZlcnNpb24rKykge1xyXG5cdFx0XHRtaWdyYXRlZERhdGEgPSBhd2FpdCBNaWdyYXRvclNlcnZpY2UuTUlHUkFUSU9OX1NURVBTW3ZlcnNpb25dKG1pZ3JhdGVkRGF0YSk7XHJcblx0XHRcdGNvbnNvbGUubG9nKGBNaWdyYXRlZCBkYXRhLmpzb24gZnJvbSBDb2xvcmVkVGFnc1dyYW5nbGVyIHRvIHZlcnNpb24gJHttaWdyYXRlZERhdGEuSW5mby5TZXR0aW5nc1ZlcnNpb259YClcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gbWlncmF0ZWREYXRhO1xyXG5cdH1cclxuXHJcbn1cclxuIl19